(function(e){"use strict";function t(t){return this.each(function(){var a=e(this),o=a.data(c.dataKey),l=e.extend({},r,a.data(),o&&o.option,"object"==typeof t&&t);o||(a.data(c.dataKey,o=new c(this,l)),a.trigger("ready.selectpage"))})}function a(t){return e(t).closest("div.sp_container").find("input.sp_input")}function o(){return this.each(function(){var e=a(this),t=e.data(c.dataKey);t&&(t.prop.init_set=!0,t.clearAll(t),t.prop.init_set=!1)})}function l(){return this.each(function(){var e=a(this),t=e.data(c.dataKey);t&&t.elem.hidden.val()&&t.setInitRecord(!0)})}function n(t){return this.each(function(){if(t&&e.isArray(t)){var o=a(this),l=o.data(c.dataKey);l&&(l.clearAll(l),l.option.data=t)}})}function i(t){var o=!1;return this.each(function(){var l=a(this),n=l.data(c.dataKey);n&&("undefined"!==e.type(t)?n.disabled(n,t):o=n.disabled(n))}),o}function s(){var t="";return this.each(function(){var o=a(this),l=o.data(c.dataKey);if(l)if(l.option.multiple){var n=[];l.elem.element_box.find("li.selected_tag").each(function(t,a){n.push(e(a).text())}),t+=n.toString()}else t+=l.elem.combo_input.val()}),t}var r={data:void 0,lang:"cn",multiple:!1,pagination:!0,dropButton:!0,listSize:10,multipleControlbar:!0,maxSelectLimit:0,selectToCloseList:!1,initRecord:void 0,dbTable:"tbl",keyField:"id",showField:"name",searchField:void 0,andOr:"AND",orderBy:!1,pageSize:10,params:void 0,formatItem:void 0,autoFillResult:!1,autoSelectFirst:!1,noResultClean:!0,selectOnly:!1,inputDelay:.5,eSelect:void 0,eOpen:void 0,eAjaxSuccess:void 0,eTagRemove:void 0,eClear:void 0},c=function(t,a){e.each({data:"source",keyField:"primaryKey",showField:"field",pageSize:"perPage"},function(e,t){void 0!==a[t]&&(a[e]=a[t],delete a[t])}),this.setOption(a),this.setLanguage(),this.setCssClass(),this.setProp(),this.setElem(t),this.setButtonAttrDefault(),this.setInitRecord(),this.eDropdownButton(),this.eInput(),this.eWhole()};c.version="2.19",c.dataKey="selectPageObject",c.prototype.setOption=function(t){t.searchField=t.searchField||t.showField,t.andOr=t.andOr.toUpperCase(),"AND"!==t.andOr&&"OR"!==t.andOr&&(t.andOr="AND");for(var a=["searchField"],o=0;o<a.length;o++)t[a[o]]=this.strToArray(t[a[o]]);t.orderBy=t.orderBy||t.showField,!1!==t.orderBy&&(t.orderBy=this.setOrderbyOption(t.orderBy,t.showField)),t.multiple&&!t.selectToCloseList&&(t.autoFillResult=!1,t.autoSelectFirst=!1),t.pagination||(t.pageSize=200),("number"!==e.type(t.listSize)||t.listSize<0)&&(t.listSize=10),this.option=t},c.prototype.strToArray=function(e){return e?e.replace(/[\s　]+/g,"").split(","):""},c.prototype.setOrderbyOption=function(t,a){var o=[],l=[];if("object"==typeof t)for(var n=0;n<t.length;n++)l=e.trim(t[n]).split(" "),l.length&&o.push(2===l.length?l.concat():[l[0],"ASC"]);else l=e.trim(t).split(" "),o[0]=2===l.length?l.concat():l[0].toUpperCase().match(/^(ASC|DESC)$/i)?[a,l[0].toUpperCase()]:[l[0],"ASC"];return o},c.prototype.setLanguage=function(){var e,t=this.option;switch(t.lang){case"de":e={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+t.pageSize+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+t.pageSize+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"page_num von page_count",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten.",clear:"Löschen Sie den Inhalt",select_all:"Wähle diese Seite",unselect_all:"Diese Seite entfernen",clear_all:"Alles löschen",max_selected:"Sie können nur bis zu max_selected_limit Elemente auswählen"};break;case"en":e={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+t.pageSize+" (Right key)",prev:"Prev",prev_title:"Prev"+t.pageSize+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"Page page_num of page_count",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server.",clear:"Clear content",select_all:"Select current page",unselect_all:"Clear current page",clear_all:"Clear all selected",max_selected:"You can only select up to max_selected_limit items"};break;case"es":e={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+t.pageSize+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+t.pageSize+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"page_num de page_count",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor.",clear:"Borrar el contenido",select_all:"Elija esta página",unselect_all:"Borrar esta página",clear_all:"Borrar todo marcado",max_selected:"Solo puedes seleccionar hasta max_selected_limit elementos"};break;case"pt-br":e={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+t.pageSize+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+t.pageSize+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"page_num de page_count",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor.",clear:"Limpe o conteúdo",select_all:"Selecione a página atual",unselect_all:"Remova a página atual",clear_all:"Limpar tudo",max_selected:"Você só pode selecionar até max_selected_limit itens"};break;case"ja":e={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+t.pageSize+"件 (右キー)",prev:"前へ",prev_title:"前の"+t.pageSize+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"page_num 件 (全 page_count 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。",clear:"コンテンツをクリアする",select_all:"当ページを選びます",unselect_all:"移して当ページを割ります",clear_all:"選択した項目をクリアする",max_selected:"最多で max_selected_limit のプロジェクトを選ぶことしかできません"};break;case"cn":default:e={add_btn:"添加按钮",add_title:"添加区域",del_btn:"删除按钮",del_title:"删除区域",next:"下一页",next_title:"下"+t.pageSize+" (→)",prev:"上一页",prev_title:"上"+t.pageSize+" (←)",first_title:"首页 (Shift + ←)",last_title:"尾页 (Shift + →)",get_all_btn:"获得全部 (↓)",get_all_alt:"(按钮)",close_btn:"关闭 (Tab键)",close_alt:"(按钮)",loading:"读取中...",loading_alt:"(读取中)",page_info:"第 page_num 页(共page_count页)",select_ng:"请注意：请从列表中选择.",select_ok:"OK : 已经选择.",not_found:"无查询结果",ajax_error:"连接到服务器时发生错误！",clear:"清除内容",select_all:"选择当前页项目",unselect_all:"取消选择当前页项目",clear_all:"清除全部已选择项目",max_selected:"最多只能选择 max_selected_limit 个项目"}}this.message=e},c.prototype.setCssClass=function(){var e={container:"sp_container",container_open:"sp_container_open",re_area:"sp_result_area",result_open:"sp_result_area_open",control_box:"sp_control_box",element_box:"sp_element_box",navi:"sp_navi",results:"sp_results",re_off:"sp_results_off",select:"sp_over",select_ok:"sp_select_ok",select_ng:"sp_select_ng",selected:"sp_selected",input_off:"sp_input_off",message_box:"sp_message_box",disabled:"sp_disabled",button:"sp_button",caret_open:"sp_caret_open",btn_on:"sp_btn_on",btn_out:"sp_btn_out",input:"sp_input",clear_btn:"sp_clear_btn",align_right:"sp_align_right"};this.css_class=e},c.prototype.setProp=function(){this.prop={disabled:!1,current_page:1,max_page:1,is_loading:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",selected_text:"",last_input_time:void 0,init_set:!1},this.template={tag:{content:'<li class="selected_tag" itemvalue="#item_value#">#item_text#<span class="tag_close"><i class="sp-iconfont if-close"></i></span></li>',textKey:"#item_text#",valueKey:"#item_value#"},page:{current:"page_num",total:"page_count"},msg:{maxSelectLimit:"max_selected_limit"}}},c.prototype.elementRealSize=function(t,a){var o,l,n,i={absolute:!1,clone:!1,includeMargin:!1,display:"block"},s=i,r=t.eq(0),c=[],p="";o=function(){n=r.parents().addBack().filter(":hidden"),p+="visibility: hidden !important; display: "+s.display+" !important; ",!0===s.absolute&&(p+="position: absolute !important;"),n.each(function(){var t=e(this),a=t.attr("style");c.push(a),t.attr("style",a?a+";"+p:p)})},l=function(){n.each(function(t){var a=e(this),o=c[t];void 0===o?a.removeAttr("style"):a.attr("style",o)})},o();var u=/(outer)/.test(a)?r[a](s.includeMargin):r[a]();return l(),u},c.prototype.setElem=function(t){var a={},o=this.option,l=this.css_class,n=this.message,i=e(t),s=i.outerWidth();s<=0&&(s=this.elementRealSize(i,"outerWidth")),s<150&&(s=150),a.combo_input=i.attr({autocomplete:"off"}).addClass(l.input).wrap("<div>"),o.selectOnly&&a.combo_input.prop("readonly",!0),a.container=a.combo_input.parent().addClass(l.container),a.combo_input.prop("disabled")&&(o.multiple?a.container.addClass(l.disabled):a.combo_input.addClass(l.input_off)),a.container.width(s),a.button=e("<div>").addClass(l.button),a.dropdown=e('<span class="sp_caret"></span>'),a.clear_btn=e("<div>").html(e("<i>").addClass("sp-iconfont if-close")).addClass(l.clear_btn).attr("title",n.clear),o.dropButton||a.clear_btn.addClass(l.align_right),a.element_box=e("<ul>").addClass(l.element_box),o.multiple&&o.multipleControlbar&&(a.control=e("<div>").addClass(l.control_box)),a.result_area=e("<div>").addClass(l.re_area),o.pagination&&(a.navi=e("<div>").addClass("sp_pagination").append("<ul>")),a.results=e("<ul>").addClass(l.results);var r="_text",c=a.combo_input.attr("id")||a.combo_input.attr("name"),p=a.combo_input.attr("name")||"selectPage",u=p,d=c;if(a.hidden=e('<input type="hidden" class="sp_hidden" />').attr({name:u,id:d}).val(""),a.combo_input.attr({name:p+r,id:c+r}),a.container.append(a.hidden),o.dropButton&&(a.container.append(a.button),a.button.append(a.dropdown)),e(document.body).append(a.result_area),a.result_area.append(a.results),o.pagination&&a.result_area.append(a.navi),o.multiple){o.multipleControlbar&&(a.control.append('<button type="button" class="btn btn-default sp_clear_all" ><i class="sp-iconfont if-clear"></i></button>'),a.control.append('<button type="button" class="btn btn-default sp_unselect_all" ><i class="sp-iconfont if-unselect-all"></i></button>'),a.control.append('<button type="button" class="btn btn-default sp_select_all" ><i class="sp-iconfont if-select-all"></i></button>'),a.control_text=e("<p>"),a.control.append(a.control_text),a.result_area.prepend(a.control)),a.container.addClass("sp_container_combo"),a.combo_input.addClass("sp_combo_input").before(a.element_box);var _=e("<li>").addClass("input_box");_.append(a.combo_input),a.element_box.append(_),a.combo_input.attr("placeholder")&&a.combo_input.attr("placeholder_bak",a.combo_input.attr("placeholder"))}this.elem=a},c.prototype.setButtonAttrDefault=function(){this.option.dropButton&&this.elem.button.attr("title",this.message.close_btn)},c.prototype.setInitRecord=function(t){var a=this,o=a.option,l=a.elem,n="";if("undefined"!=e.type(l.combo_input.data("init"))&&(o.initRecord=String(l.combo_input.data("init"))),t||o.initRecord||!l.combo_input.val()||(o.initRecord=l.combo_input.val()),l.combo_input.val(""),t||l.hidden.val(o.initRecord),n=t&&l.hidden.val()?l.hidden.val():o.initRecord,n)if("object"==typeof o.data){var i=new Array,s=n.split(",");e.each(s,function(e,t){for(var a=0;a<o.data.length;a++)if(o.data[a][o.keyField]==t){i.push(o.data[a]);break}}),!o.multiple&&i.length>1&&(i=[i[0]]),a.afterInit(a,i)}else{var r=o.params,c={},p=(o.searchField,{searchTable:o.dbTable,searchKey:o.keyField,searchValue:n,orderBy:o.orderBy,showField:o.showField,keyField:o.keyField,keyValue:n,searchField:o.searchField});if(r){var u=e.isFunction(r)?r(a):r;c=u&&e.isPlainObject(u)?e.extend({},p,u):p}else c=p;e.ajax({dataType:"json",type:"POST",url:o.data,data:c,success:function(t){var l=t;o.eAjaxSuccess&&e.isFunction(o.eAjaxSuccess)&&(l=o.eAjaxSuccess(t)),a.afterInit(a,l.list)},error:function(){a.ajaxErrorNotify(a)}})}},c.prototype.afterInit=function(t,a){if(a&&(!e.isArray(a)||0!==a.length)){e.isArray(a)||(a=[a]);var o=t.option,l=t.css_class,n=function(t){var a=t[o.showField];if(o.formatItem&&e.isFunction(o.formatItem))try{a=o.formatItem(t)}catch(e){}return a};if(o.multiple)t.prop.init_set=!0,t.clearAll(t),e.each(a,function(e,a){var l={text:n(a),value:a[o.keyField]};t.isAlreadySelected(t,l)||t.addNewTag(t,a,l)}),t.tagValuesSet(t),t.inputResize(t),t.prop.init_set=!1;else{var i=a[0];t.elem.combo_input.val(n(i)),t.elem.hidden.val(i[o.keyField]),t.prop.prev_value=n(i),t.prop.selected_text=n(i),o.selectOnly&&t.elem.combo_input.attr("title",t.message.select_ok).removeClass(l.select_ng).addClass(l.select_ok),t.putClearButton()}}},c.prototype.eDropdownButton=function(){var e=this;e.option.dropButton&&e.elem.button.mouseup(function(t){t.stopPropagation(),e.elem.result_area.is(":hidden")&&!e.elem.combo_input.prop("disabled")?e.elem.combo_input.focus():e.hideResults(e)})},c.prototype.eInput=function(){var t=this,a=t.option,o=t.elem,l=t.message,n=function(){t.prop.page_move=!1,t.suggest(t),t.setCssFocusedInput(t)};o.combo_input.keyup(function(e){t.processKey(t,e)}).keydown(function(e){t.processControl(t,e)}).focus(function(e){o.result_area.is(":hidden")&&(e.stopPropagation(),t.prop.first_show=!0,n())}),o.container.on("click.SelectPage","div."+t.css_class.clear_btn,function(o){o.stopPropagation(),t.disabled(t)||(t.clearAll(t,!0),a.eClear&&e.isFunction(a.eClear)&&a.eClear(t))}),o.result_area.on("mousedown.SelectPage",function(e){e.stopPropagation()}),a.multiple&&(a.multipleControlbar&&(o.control.find(".sp_select_all").on("click.SelectPage",function(){t.selectAllLine(t)}).hover(function(){o.control_text.html(l.select_all)},function(){o.control_text.html("")}),o.control.find(".sp_unselect_all").on("click.SelectPage",function(){t.unSelectAllLine(t)}).hover(function(){o.control_text.html(l.unselect_all)},function(){o.control_text.html("")}),o.control.find(".sp_clear_all").on("click.SelectPage",function(){t.clearAll(t,!0)}).hover(function(){o.control_text.html(l.clear_all)},function(){o.control_text.html("")})),o.element_box.on("click.SelectPage",function(t){var a=t.target||t.srcElement;e(a).is("ul")&&o.combo_input.focus()}),o.element_box.on("click.SelectPage","span.tag_close",function(){var o=e(this).closest("li"),l=o.data("dataObj");t.removeTag(t,o),n(),a.eTagRemove&&e.isFunction(a.eTagRemove)&&a.eTagRemove([l])}),t.inputResize(t))},c.prototype.eWhole=function(){var t=this,a=t.css_class,o=function(e){e.elem.combo_input.val(""),e.option.multiple||e.elem.hidden.val(""),e.prop.selected_text=""};e(document.body).off("mousedown.selectPage").on("mousedown.selectPage",function(t){var l=t.target||t.srcElement,n=e(l).closest("div."+a.container);e("div."+a.container+"."+a.container_open).each(function(){if(this!=n[0]){var t=e(this),l=t.find("input."+a.input).data(c.dataKey);if(!l.elem.combo_input.val()&&l.elem.hidden.val()&&!l.option.multiple)return l.prop.current_page=1,o(l),l.hideResults(l),!0;l.elem.results.find("li").not("."+a.message_box).length?l.option.autoFillResult?l.elem.hidden.val()?l.hideResults(l):l.elem.results.find("li.sp_over").length?l.selectCurrentLine(l):l.option.autoSelectFirst?(l.nextLine(l),l.selectCurrentLine(l)):l.hideResults(l):l.hideResults(l):(l.option.noResultClean?o(l):l.option.multiple||l.elem.hidden.val(""),l.hideResults(l))}}),e("div."+a.container).each(function(){if(this!=n[0]){var t=e(this),o=t.find("input."+a.input).data(c.dataKey);o.hideResults(o),o.elem.hidden.trigger("blur.SelectPage")}})})},c.prototype.eResultList=function(){var t=this,a=this.css_class;t.elem.results.children("li").hover(function(){t.prop.key_select?t.prop.key_select=!1:e(this).hasClass(a.selected)||e(this).hasClass(a.message_box)||(e(this).addClass(a.select),t.setCssFocusedResults(t))},function(){e(this).removeClass(a.select)}).click(function(o){t.prop.key_select?t.prop.key_select=!1:(o.preventDefault(),o.stopPropagation(),e(this).hasClass(a.selected)||t.selectCurrentLine(t))})},c.prototype.eScroll=function(){var t=this.css_class;e(window).on("scroll.SelectPage",function(){e("div."+t.container+"."+t.container_open).each(function(){var a=e(this),o=a.find("input."+t.input).data(c.dataKey),l=o.elem.result_area.offset(),n=e(window).scrollTop(),i=e(document).height(),s=e(window).height(),r=o.elem.result_area.outerHeight(),p=l.top+r,u=i>s,d=o.elem.result_area.hasClass("shadowDown");u&&(d?p>s+n&&o.calcResultsSize(o):l.top<n&&o.calcResultsSize(o))})})},c.prototype.ePaging=function(){var e=this;e.option.pagination&&(e.elem.navi.find("li.csFirstPage").off("click").on("click",function(t){t.preventDefault(),e.firstPage(e)}),e.elem.navi.find("li.csPreviousPage").off("click").on("click",function(t){t.preventDefault(),e.prevPage(e)}),e.elem.navi.find("li.csNextPage").off("click").on("click",function(t){t.preventDefault(),e.nextPage(e)}),e.elem.navi.find("li.csLastPage").off("click").on("click",function(t){t.preventDefault(),e.lastPage(e)}))},c.prototype.ajaxErrorNotify=function(e){e.showMessage(e.message.ajax_error)},c.prototype.showMessage=function(e,t){if(t){var a='<li class="'+e.css_class.message_box+'"><i class="sp-iconfont if-warning"></i> '+t+"</li>";e.elem.results.empty().append(a).show(),e.calcResultsSize(e),e.setOpenStatus(e,!0),e.elem.control.hide(),e.option.pagination&&e.elem.navi.hide()}},c.prototype.scrollWindow=function(t,a){var o,l=t.getCurrentLine(t),n=l&&!a?l.offset().top:t.elem.container.offset().top;t.prop.size_li=t.elem.results.children("li:first").outerHeight(),o=t.prop.size_li;var i,s=e(window).height(),r=e(window).scrollTop(),c=r+s-o;if(l.length)if(n<r||o>s)i=n-r;else{if(!(n>c))return;i=n-c}else n<r&&(i=n-r);window.scrollBy(0,i)},c.prototype.setOpenStatus=function(e,t){var a=e.elem,o=e.css_class;t?(a.container.addClass(o.container_open),a.result_area.addClass(o.result_open)):(a.container.removeClass(o.container_open),a.result_area.removeClass(o.result_open))},c.prototype.setCssFocusedInput=function(e){},c.prototype.setCssFocusedResults=function(e){},c.prototype.checkValue=function(e){var t=e.elem.combo_input.val();t!=e.prop.prev_value&&(e.prop.prev_value=t,e.prop.first_show=!1,e.option.selectOnly&&e.setButtonAttrDefault(),e.option.multiple||t||(e.elem.combo_input.val(""),e.elem.hidden.val(""),e.elem.clear_btn.remove()),e.suggest(e))},c.prototype.processKey=function(t,a){-1===e.inArray(a.keyCode,[37,38,39,40,27,9,13])&&(16!=a.keyCode&&t.setCssFocusedInput(t),t.inputResize(t),"string"===e.type(t.option.data)?(t.prop.last_input_time=a.timeStamp,setTimeout(function(){a.timeStamp-t.prop.last_input_time==0&&t.checkValue(t)},1e3*t.option.inputDelay)):t.checkValue(t))},c.prototype.processControl=function(t,a){if(e.inArray(a.keyCode,[37,38,39,40,27,9])>-1&&t.elem.result_area.is(":visible")||e.inArray(a.keyCode,[13,9])>-1&&t.getCurrentLine(t))switch(a.preventDefault(),a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1,a.keyCode){case 37:a.shiftKey?t.firstPage(t):t.prevPage(t);break;case 38:t.prop.key_select=!0,t.prevLine(t);break;case 39:a.shiftKey?t.lastPage(t):t.nextPage(t);break;case 40:t.elem.results.children("li").length?(t.prop.key_select=!0,t.nextLine(t)):t.suggest(t);break;case 9:t.prop.key_paging=!0,t.selectCurrentLine(t);break;case 13:t.selectCurrentLine(t);break;case 27:t.prop.key_paging=!0,t.hideResults(t)}},c.prototype.abortAjax=function(e){e.prop.xhr&&(e.prop.xhr.abort(),e.prop.xhr=!1)},c.prototype.suggest=function(t){var a,o=e.trim(t.elem.combo_input.val());a=t.option.multiple?o:o&&o===t.prop.selected_text?"":o,a=a.split(/[\s　]+/),t.option.eOpen&&e.isFunction(t.option.eOpen)&&t.option.eOpen.call(t),t.abortAjax(t);var l=t.prop.current_page||1;"object"==typeof t.option.data?t.searchForJson(t,a,l):t.searchForDb(t,a,l)},c.prototype.setLoading=function(e){""===e.elem.results.html()&&e.setOpenStatus(e,!0)},c.prototype.searchForDb=function(t,a,o){var l=t.option;l.eAjaxSuccess&&e.isFunction(l.eAjaxSuccess)||t.hideResults(t);var n=l.params,i={},s=l.searchField;a.length&&a[0]&&a[0]!==t.prop.prev_value&&(o=1);var r={q_word:a,pageNumber:o,pageSize:l.pageSize,andOr:l.andOr,orderBy:l.orderBy,searchTable:l.dbTable,showField:t.option.showField,keyField:t.option.keyField,searchField:t.option.searchField};if(!1!==l.orderBy&&(r.orderBy=l.orderBy),r[s]=a[0],n){var c=e.isFunction(n)?n.call(t):n;i=c&&e.isPlainObject(c)?e.extend({},r,c):r}else i=r;t.prop.xhr=e.ajax({dataType:"json",url:l.data,type:"POST",data:i,success:function(n){if(!n||!e.isPlainObject(n))return t.hideResults(t),void t.ajaxErrorNotify(t);var i={},s={};try{i=n,l.eAjaxSuccess&&e.isFunction(l.eAjaxSuccess)&&(i=l.eAjaxSuccess(n)),s.originalResult=i.list,s.cnt_whole=i.totalRow}catch(e){return void t.showMessage(t,t.message.ajax_error)}if(s.candidate=[],s.keyField=[],"object"!=typeof s.originalResult)return t.prop.xhr=null,void t.notFoundSearch(t);s.cnt_page=s.originalResult.length;for(var r=0;r<s.cnt_page;r++)for(var c in s.originalResult[r])c==l.keyField&&s.keyField.push(s.originalResult[r][c]),c==l.showField&&s.candidate.push(s.originalResult[r][c]);t.prepareResults(t,s,a,o)},error:function(e,a){"abort"!=a&&(t.hideResults(t),t.ajaxErrorNotify(t))},complete:function(){t.prop.xhr=null}})},c.prototype.searchForJson=function(t,a,o){var l=t.option,n=[],i=[],s=[],r={},c=0,p=[];do{i[c]=a[c].replace(/\W/g,"\\$&").toString(),p[c]=new RegExp(i[c],"gi"),c++}while(c<a.length);for(c=0;c<l.data.length;c++){for(var u,d=!1,_=l.data[c],m=0;m<p.length;m++)if(u=_[l.searchField],l.formatItem&&e.isFunction(l.formatItem)&&(u=l.formatItem(_)),u.match(p[m])){if(d=!0,"OR"==l.andOr)break}else if(d=!1,"AND"==l.andOr)break;d&&n.push(_)}if(!1===l.orderBy)s=n.concat();else{var f=new RegExp("^"+i[0]+"$","gi"),g=new RegExp("^"+i[0],"gi"),h=[],v=[],b=[];for(c=0;c<n.length;c++){var y=l.orderBy[0][0],x=String(n[c][y]);x.match(f)?h.push(n[c]):x.match(g)?v.push(n[c]):b.push(n[c])}l.orderBy[0][1].match(/^asc$/i)?(h=t.sortAsc(t,h),v=t.sortAsc(t,v),b=t.sortAsc(t,b)):(h=t.sortDesc(t,h),v=t.sortDesc(t,v),b=t.sortDesc(t,b)),s=s.concat(h).concat(v).concat(b)}if(r.cnt_whole=s.length,t.prop.page_move)s.length<=(o-1)*l.pageSize&&(o=1,t.prop.current_page=1);else if(!l.multiple){var S=t.elem.hidden.val();if("undefined"!==e.type(S)&&""!==e.trim(S)){var C=0;e.each(s,function(e,t){if(t[l.keyField]==S)return C=e+1,!1}),o=Math.ceil(C/l.pageSize),o<1&&(o=1),t.prop.current_page=o}}var k=(o-1)*l.pageSize,w=k+l.pageSize;for(r.originalResult=[],c=k;c<w&&void 0!==s[c];c++)for(var F in r.originalResult.push(s[c]),s[c])F==l.keyField&&(void 0===r.keyField&&(r.keyField=[]),r.keyField.push(s[c][F])),F==l.showField&&(void 0===r.candidate&&(r.candidate=[]),r.candidate.push(s[c][F]));void 0===r.candidate&&(r.candidate=[]),r.cnt_page=r.candidate.length,t.prepareResults(t,r,a,o)},c.prototype.sortAsc=function(t,a){return a.sort(function(a,o){var l=a[t.option.orderBy[0][0]],n=o[t.option.orderBy[0][0]];return"number"===e.type(l)?l-n:String(l).localeCompare(String(n))}),a},c.prototype.sortDesc=function(t,a){return a.sort(function(a,o){var l=a[t.option.orderBy[0][0]],n=o[t.option.orderBy[0][0]];return"number"===e.type(l)?n-l:String(n).localeCompare(String(l))}),a},c.prototype.notFoundSearch=function(e){e.elem.results.empty(),e.calcResultsSize(e),e.setOpenStatus(e,!0),e.setCssFocusedInput(e)},c.prototype.prepareResults=function(e,t,a,o){e.option.pagination&&e.setNavi(e,t.cnt_whole,t.cnt_page,o),t.keyField||(t.keyField=!1),e.option.selectOnly&&1===t.candidate.length&&t.candidate[0]==a[0]&&(e.elem.hidden.val(t.keyField[0]),this.setButtonAttrDefault());var l=!1;a&&a.length&&a[0]&&(l=!0),e.displayResults(e,t,l)},c.prototype.setNavi=function(e,t,a,o){var l=e.message,n=function(e,t,a,o){var n=function(){var t=l.page_info;return t.replace(e.template.page.current,a).replace(e.template.page.total,o)};if(0===t.find("li").length){t.hide().empty();var i="sp-iconfont if-first",s="sp-iconfont if-previous",r="sp-iconfont if-next",c="sp-iconfont if-last";t.append('<li class="csFirstPage" title="'+l.first_title+'" ><a href="javascript:void(0);"> <i class="'+i+'"></i> </a></li>'),t.append('<li class="csPreviousPage" title="'+l.prev_title+'" ><a href="javascript:void(0);"><i class="'+s+'"></i></a></li>'),t.append('<li class="pageInfoBox"><a href="javascript:void(0);"> '+n()+" </a></li>"),t.append('<li class="csNextPage" title="'+l.next_title+'" ><a href="javascript:void(0);"><i class="'+r+'"></i></a></li>'),t.append('<li class="csLastPage" title="'+l.last_title+'" ><a href="javascript:void(0);"> <i class="'+c+'"></i> </a></li>'),t.show()}else t.find("li.pageInfoBox a").html(n())},i=e.elem.navi.find("ul"),s=Math.ceil(t/e.option.pageSize);0===s?o=0:s<o?o=s:0===o&&(o=1),e.prop.current_page=o,e.prop.max_page=s,n(e,i,o,s);var r="disabled",c=i.find("li.csFirstPage"),p=i.find("li.csPreviousPage"),u=i.find("li.csNextPage"),d=i.find("li.csLastPage");1===o||0===o?(c.hasClass(r)||c.addClass(r),p.hasClass(r)||p.addClass(r)):(c.hasClass(r)&&c.removeClass(r),p.hasClass(r)&&p.removeClass(r)),o===s||0===s?(u.hasClass(r)||u.addClass(r),d.hasClass(r)||d.addClass(r)):(u.hasClass(r)&&u.removeClass(r),d.hasClass(r)&&d.removeClass(r)),s>1&&e.ePaging()},c.prototype.displayResults=function(t,a,o){var l=t.option,n=t.elem;if(n.results.hide().empty(),l.multiple&&"number"===e.type(l.maxSelectLimit)&&l.maxSelectLimit>0){var i=n.element_box.find("li.selected_tag").length;if(i>0&&i>=l.maxSelectLimit){var s=t.message.max_selected;return void t.showMessage(t,s.replace(t.template.msg.maxSelectLimit,l.maxSelectLimit))}}if(a.candidate.length)for(var r=a.candidate,c=a.keyField,p=n.hidden.val(),u=p?p.split(","):new Array,d="",_=0;_<r.length;_++){if(l.formatItem&&e.isFunction(l.formatItem))try{d=l.formatItem(a.originalResult[_])}catch(e){console.error("formatItem内容格式化函数内容设置不正确！"),d=r[_]}else d=r[_];var m=e("<li>").html(d).attr({pkey:c[_]});l.formatItem||m.attr("title",d),-1!==e.inArray(c[_].toString(),u)&&m.addClass(t.css_class.selected),m.data("dataObj",a.originalResult[_]),n.results.append(m)}else{var f='<li class="'+t.css_class.message_box+'"><i class="sp-iconfont if-warning"></i> '+t.message.not_found+"</li>";n.results.append(f)}n.results.show(),l.multiple&&l.multipleControlbar&&n.control.show(),l.pagination&&n.navi.show(),t.calcResultsSize(t),t.setOpenStatus(t,!0),t.eResultList(),t.eScroll(),o&&a.candidate.length&&l.autoSelectFirst&&t.nextLine(t)},c.prototype.calcResultsSize=function(t){var a=t.option,o=t.elem,l=function(){if("static"!==o.container.css("position")){var t;if(!a.pagination){var l=o.results.find("li:first").outerHeight(!0);t=l*a.listSize,o.results.css({"max-height":t,"overflow-y":"auto"})}var n=e(document).width(),i=e(document).height(),s=e(window).height(),r=o.container.offset(),c=e(window).scrollTop(),p=o.result_area.outerWidth(),u=r.left,d=o.container.outerHeight(),_=r.left+p>n?u-(p-o.container.outerWidth()):u,m=r.top,f=0,g=5,h=m+d+t+g,v=i>s;return t=o.result_area.outerHeight(),m-c-g>t&&v&&h>s+c||!v&&h>s?(f=r.top-t-g,o.result_area.removeClass("shadowUp shadowDown").addClass("shadowUp")):(f=r.top+(a.multiple?o.container.outerHeight():d),o.result_area.removeClass("shadowUp shadowDown").addClass("shadowDown"),f+=g),{top:f+"px",left:_+"px"}}var b=o.combo_input.offset();o.result_area.css({top:b.top+o.combo_input.outerHeight()+"px",left:b.left+"px"})};if(o.result_area.is(":visible"))o.result_area.css(l());else{var n=l();o.result_area.css(n).show(1,function(){var e=l();n.top===e.top&&n.left===e.left||o.result_area.css(e)})}},c.prototype.hideResults=function(t){t.prop.key_paging&&(t.scrollWindow(t,!0),t.prop.key_paging=!1),t.setCssFocusedInput(t),t.option.autoFillResult,t.elem.results.empty(),t.elem.result_area.hide(),t.setOpenStatus(t,!1),e(window).off("scroll.SelectPage"),t.abortAjax(t),t.setButtonAttrDefault()},c.prototype.disabled=function(t,a){var o=t.elem;if("undefined"===e.type(a))return o.combo_input.prop("disabled");"boolean"===e.type(a)&&(o.combo_input.prop("disabled",a),a?o.container.addClass(t.css_class.disabled):o.container.removeClass(t.css_class.disabled))},c.prototype.firstPage=function(e){e.prop.current_page>1&&(e.prop.current_page=1,e.prop.page_move=!0,e.suggest(e))},c.prototype.prevPage=function(e){e.prop.current_page>1&&(e.prop.current_page--,e.prop.page_move=!0,e.suggest(e))},c.prototype.nextPage=function(e){e.prop.current_page<e.prop.max_page&&(e.prop.current_page++,e.prop.page_move=!0,e.suggest(e))},c.prototype.lastPage=function(e){e.prop.current_page<e.prop.max_page&&(e.prop.current_page=e.prop.max_page,e.prop.page_move=!0,e.suggest(e))},c.prototype.afterAction=function(e,t){e.inputResize(e),e.elem.combo_input.change(),e.setCssFocusedInput(e),e.prop.init_set||(e.option.multiple?(e.option.selectToCloseList&&(e.hideResults(e),e.elem.combo_input.blur()),!e.option.selectToCloseList&&t&&(e.suggest(e),e.elem.combo_input.focus())):(e.hideResults(e),e.elem.combo_input.blur()))},c.prototype.selectCurrentLine=function(t){t.scrollWindow(t,!0);var a=t.option,o=t.getCurrentLine(t);if(o){var l=o.data("dataObj");if(a.multiple){t.elem.combo_input.val("");var n={text:o.text(),value:o.attr("pkey")};t.isAlreadySelected(t,n)||(t.addNewTag(t,l,n),t.tagValuesSet(t))}else t.elem.combo_input.val(o.text()),t.elem.hidden.val(o.attr("pkey"));a.selectOnly&&t.setButtonAttrDefault(),a.eSelect&&e.isFunction(a.eSelect)&&a.eSelect(l,t),t.prop.prev_value=t.elem.combo_input.val(),t.prop.selected_text=t.elem.combo_input.val(),t.putClearButton()}t.afterAction(t,!0)},c.prototype.putClearButton=function(){this.option.multiple||this.elem.combo_input.prop("disabled")||this.elem.container.append(this.elem.clear_btn)},c.prototype.selectAllLine=function(t){var a=t.option,o=new Array;t.elem.results.find("li").each(function(l,n){var i=e(n),s=i.data("dataObj"),r={text:i.text(),value:i.attr("pkey")};if(t.isAlreadySelected(t,r)||(t.addNewTag(t,s,r),t.tagValuesSet(t)),o.push(s),"number"===e.type(a.maxSelectLimit)&&a.maxSelectLimit>0&&a.maxSelectLimit===t.elem.element_box.find("li.selected_tag").length)return!1}),a.eSelect&&e.isFunction(a.eSelect)&&a.eSelect(o,t),t.afterAction(t,!0)},c.prototype.unSelectAllLine=function(t){var a=t.option,o=[];t.elem.results.find("li").each(function(a,l){var n=e(l).attr("pkey"),i=t.elem.element_box.find('li.selected_tag[itemvalue="'+n+'"]');i.length&&o.push(i.data("dataObj")),t.removeTag(t,i)}),t.afterAction(t,!0),a.eTagRemove&&e.isFunction(a.eTagRemove)&&a.eTagRemove(o)},c.prototype.clearAll=function(t,a){var o=t.option,l=[];o.multiple&&(t.elem.element_box.find("li.selected_tag").each(function(t,a){l.push(e(a).data("dataObj")),a.remove()}),t.elem.element_box.find("li.selected_tag").remove()),t.reset(t),t.afterAction(t,a),o.multiple?o.eTagRemove&&e.isFunction(o.eTagRemove)&&o.eTagRemove(l):t.elem.clear_btn.remove()},c.prototype.reset=function(e){e.elem.combo_input.val(""),e.elem.hidden.val(""),e.prop.prev_value="",e.prop.selected_text="",e.prop.current_page=1},c.prototype.getCurrentLine=function(e){
if(e.elem.result_area.is(":hidden"))return!1;var t=e.elem.results.find("li."+e.css_class.select);return!!t.length&&t},c.prototype.isAlreadySelected=function(t,a){var o=!1;if(a.value){var l=t.elem.hidden.val();if(l){var n=l.split(",");n&&n.length&&-1!=e.inArray(a.value,n)&&(o=!0)}}return o},c.prototype.addNewTag=function(t,a,o){if(t.option.multiple&&a&&o){var l,n=t.template.tag.content;n=n.replace(t.template.tag.textKey,o.text),n=n.replace(t.template.tag.valueKey,o.value),l=e(n),l.data("dataObj",a),t.elem.combo_input.prop("disabled")&&l.find("span.tag_close").hide(),t.elem.combo_input.closest("li").before(l)}},c.prototype.removeTag=function(t,a){var o=e(a).attr("itemvalue"),l=t.elem.hidden.val();if("undefined"!=e.type(o)&&l){var n=l.split(","),i=e.inArray(o.toString(),n);-1!=i&&(n.splice(i,1),t.elem.hidden.val(n.toString()))}e(a).remove(),t.inputResize(t)},c.prototype.tagValuesSet=function(t){if(t.option.multiple){var a=t.elem.element_box.find("li.selected_tag");if(a&&a.length){var o=new Array;e.each(a,function(t,a){var l=e(a).attr("itemvalue");"undefined"!==e.type(l)&&o.push(l)}),o.length&&t.elem.hidden.val(o.join(","))}}},c.prototype.inputResize=function(e){if(e.option.multiple){var t=e.elem.combo_input.closest("li"),a=function(e,t){t.removeClass("full_width");var a=e.elem.combo_input.val().length+1,o=.75*a+"em";e.elem.combo_input.css("width",o).removeAttr("placeholder")};0===e.elem.element_box.find("li.selected_tag").length&&e.elem.combo_input.attr("placeholder_bak")?(t.hasClass("full_width")||t.addClass("full_width"),e.elem.combo_input.attr("placeholder",e.elem.combo_input.attr("placeholder_bak")).removeAttr("style")):a(e,t)}},c.prototype.nextLine=function(e){var t,a=e.getCurrentLine(e);if(a?(t=e.elem.results.children("li").index(a),a.removeClass(e.css_class.select)):t=-1,t++,t<e.elem.results.children("li").length){var o=e.elem.results.children("li").eq(t);o.addClass(e.css_class.select),e.setCssFocusedResults(e)}else e.setCssFocusedInput(e);e.scrollWindow(e,!1)},c.prototype.prevLine=function(e){var t,a=e.getCurrentLine(e);if(a?(t=e.elem.results.children("li").index(a),a.removeClass(e.css_class.select)):t=e.elem.results.children("li").length,t--,t>-1){var o=e.elem.results.children("li").eq(t);o.addClass(e.css_class.select),e.setCssFocusedResults(e)}else e.setCssFocusedInput(e);e.scrollWindow(e,!1)};var p=e.fn.selectPage;e.fn.selectPage=t,e.fn.selectPage.Constructor=c,e.fn.selectPageClear=o,e.fn.selectPageRefresh=l,e.fn.selectPageData=n,e.fn.selectPageDisabled=i,e.fn.selectPageText=s,e.fn.selectPage.noConflict=function(){return e.fn.selectPage=p,this}})(window.jQuery);